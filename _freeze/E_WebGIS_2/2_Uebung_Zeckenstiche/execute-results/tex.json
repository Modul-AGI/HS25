{
  "hash": "9c530451cbf14c97ab1eefa2fe4acd87",
  "result": {
    "engine": "jupyter",
    "markdown": "---\necho: false                      # set to true to show solution\ncode-fold: false                 # set to true to show solution\ncode-summary: \"Musterlösung\"    \n---\n\n# Übung Visualisierung Zeckenstiche\n\nIn dieser Übung wollen wir mit unseren originalen und simulierten Zeckenstichen aus dem Block Programmieren eine interaktive Karte erstellen.\nZudem werdet ihr weitere Tools und Tipps erhalten, wie ihr euer Jupyter Notebook aufwerten und zum Schluss Online über GitHub publizieren könnt.\n\n## Übung 1: Vorbereitung\n\n1. Bitte ladet zuerst die Übungsdaten [hier](https://moodle.zhaw.ch/mod/resource/view.php?id=1087475) runter und entpackt diese.\n\n2. Um technische Probleme zu vermeiden, haben wir heute eine ZHAW-eigene Cloud Lösung vorbereitet. Es handelt sich dabei um eine *gehostete* Version von Jupyter Lab, auf welche ihr euch mit eurem ZHAW Benutzername und Passwort einloggen könnt: [statistik-ide.zhaw.ch](https://statistik-ide.zhaw.ch). Klickt auf `+ New Session` und wählt `JupyterLab` und gebt einen Session Namen ein. \n\n**Wer allerdings lieber lokal arbeiten möchte kann dies gerne tun, mit den Kentnissen aus Programmieren I - III sollte das gut möglich sein. Jedoch müssen diese noch das Programm Quarto installieren, sowie das fehlende Package Folium via conda installieren**. \n\n![](figures/jupyter_notebook_1.PNG)\n\n3. Wenn die Session geladen ist, könnt ihr eure Übungsdaten über den `Upload` Button hochladen. Öffnet anschliessend ein neues Jupyter Notebook und speichert es unter dem Namen `visualisierung_zeckenstiche.ipynb`.\n\n4. Nun müssen wir noch die Packages installieren, die wir in dieser Session haben wollen. Statt `conda` verwenden wir jetzt allerdings `pip`, da die Serverlösung mit diesem Packagemanager arbeitet.\n\n::: {.cell execution_count=1}\n``` {.python .cell-code}\npip install geopandas folium matplotlib mapclassify\n```\n:::\n\n\nStartet nun das Kernel neu über Kernel -> Restart.\n\nImportiert nun als erstes die zwei Packages `geopandas` und `folium`.\n\n::: {.cell execution_count=2}\n\n::: {.cell-output .cell-output-error}\n```\nModuleNotFoundError: No module named 'geopandas'\n```\n:::\n:::\n\n\nLadet zudem die drei Datensätze `wald.gpkg`, `zeckenstiche_original.gpkg` und `zeckenstiche_simuliert.gpkg` mit der `read_file` Funktion von Geopandas in euer Jupyter Notebook.\n\n::: {.cell execution_count=3}\n\n::: {.cell-output .cell-output-error}\n```\nNameError: name 'gpd' is not defined\n```\n:::\n:::\n\n\n## Übung 2: Base Map\nNun können wir unsere Karte bauen. Zuerst müssen wir eine Basiskarte erstellen, zu welcher wir dann die weiteren Layer hinzufügen können. Dazu nutzen wir nun Folium. Als Mittelpunkt der Karte wählen wir die WGS84 Koordinaten der Stadt Zürich (Zurich latitude: 47.36667, longitude: 8.55) aus.\n\n::: {.cell execution_count=4}\n``` {.python .cell-code code-fold=\"false\"}\n# Zurich latitude longitude: 47.36667, 8.55\nmap = folium.Map(location=[47.36667, 8.55], zoom_start = 13, tiles = \"cartodbpositron\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nNameError: name 'folium' is not defined\n```\n:::\n:::\n\n\nIhr könnt mit den Tiles und dem Zoom Level experimentieren. Information zu den Tiles findet ihr [hier](https://python-visualization.github.io/folium/latest/user_guide/raster_layers/tiles.html).\n\n## Übung 3: Wald Layer hinzufügen\n\nNun wollen wir die Waldflächen als unseren ersten Layer hinzufügen. Ihr habt die .explore() Funktion bereits kennengelernt. Sie verfügt über diverse interessante Attribute, welche wir nun benutzen wollen.\n\nDa unser Wald Datensatz aus zwei Zeilen mit Wald und nicht Wald besteht, müssen wir die Waldflächen zuerst noch rausfiltern. \n\nFolium kann nur das weltweite CRS WGS84 (EPSG:4326) verarbeiten und da der Geodataframe Wald das Schweizer CRS CH1903+ / LV95 (EPSG:2056) verwendet, müssen wir dieses mittels `to_crs()` transformieren, bevor wir ihn visualisieren können.\n\nTipp: Wenn ihr am Schluss des Commands ein ; hinzufügt, wird kein Output generiert. Somit wird nicht für jeden Layer den wir hinzufügen, eine Karte erstellt.\n\n::: {.cell execution_count=5}\n``` {.python .cell-code code-fold=\"false\"}\n# Wald zur Karte hinzufügen\nis_wald = wald[wald[\"Wald_text\"] == \"ja\"] # Selektieren nur den Wald\nis_wald.to_crs(4326).explore(\n    m = map,           # Fügt diesen Layer der Map map hinzu\n    color = \"green\",   # Der Layer wird grün dargestellt\n    tooltip = False,   # Es werden keine Daten angezeigt, wenn man über ein Objekt hovered.\n    highlight = False, # Das Objekt wird nicht hervorgehoben, wenn man darüber hovered.\n    name = \"Wald\"      # Der Name des Layers\n);\n```\n:::\n\n\n## Übung 4: Original und simulierter Zeckenstich Layer hinzufügen\n\nNun wollen wir neben dem Wald Layer (Polygon) den originalen Zeckenstiche Layer (Punkte) hinzufügen. Kopiere dazu den unteren Code. \n\n::: {.cell execution_count=6}\n``` {.python .cell-code code-fold=\"false\"}\n# Original Zeckenstiche zur Karte hinzufügen\nzeckenstiche_original_gpd.to_crs(4326).explore(\n    m = map,                                     # Fügt diesen Layer der Map map hinzu\n    color = \"red\",                               # Der Layer wird rot dargestellt\n    marker_kwds = dict(radius = 1, fill = True), # Optionen für das Aussehen der Punkte\n    tooltip = \"ID\",                              # Beim Hovern über das Objekt wird die ID dargestellt\n    name = \"Original Zeckenstiche\"               # Der Name des Layers\n);\n```\n:::\n\n\nNun wollen wir die simulierten Zeckenstiche darstellen. Als Vorlage könnt ihr den Code von oben kopieren. Erweitere die Funktion `explore` um folgende Logik:\n\n- Gerne würden wir die Spalte \"Radius\" mit der Farbvariation viridis visualisieren. Nutze hierfür die Attribute `column` und `cmap`.\n- Zudem soll die Legende des Layers dargestellt werden. Zudem wollen wir keine Colorbar als Legende haben. Nutze dafür die Optionen der Legende `legend_kwds = dict(colorbar = False)`. \n- In den Tooltips sollen neben der ID noch der Radius und der Run dargestellt werden. \n- Nenne den Layer \"Simulation Zeckenstiche\".\n\nWeitere Informationen zur `explore` Funktion findet ihr [hier](https://geopandas.org/en/stable/docs/reference/api/geopandas.GeoDataFrame.explore.html).\n\n\n\n## Übung 5: Layer Control hinzufügen\n\nZum Abschluss wollen wir noch ein `Layer Control` hinzufügen, damit wir die verschiedenen Layer ein- und ausblenden können.\nSchaut dafür im [User Guide von Folium](https://python-visualization.github.io/folium/latest/user_guide.html) und sucht nach der Layer Control Funktion und versucht diese eurer `map` hinzuzufügen. Zum Schluss kannst du die `map` aufrufen, damit diese Dargestellt wird. Das finale Produkt sollte wie folgt aussehen:\n\n::: {.cell execution_count=8}\n\n::: {.cell-output .cell-output-error}\n```\nNameError: name 'folium' is not defined\n```\n:::\n:::\n\n\n::: {.cell execution_count=9}\n\n::: {.cell-output .cell-output-display execution_count=8}\n```\nmap\n```\n:::\n:::\n\n\nNun ist unsere Map fertig. Inspiziert diese und spielt mit den `Radien` und `Runs` herum und versucht auch die Grössen und Farben der Points anzupassen, bis Ihr mit dem Resultat zufrieden seid.\n\n## Übung 6: Notebook verschönern\n\n### Input\n\nUm unser Notebook zu verschönern werden wir das hilfreiche Tool [Quarto](https://quarto.org/) verwenden. Dieses erlaubt es uns dynamischen Output zu generieren und ist eine Erweiterung zum klassischen Markdown. Mithilfe von Quarto kann euer Code in diverse Formate (PDF, HTML, ePub, und weitere) transformiert werden. \n\n#### Vorbereiten von Quarto\n\nFügt ganz oben in eurem Notebook eine neue *raw* Cell ein und kopiert folgende Metadaten für Quarto. Dies bewirkt, dass euer Quarto Output ein Titel und Autor hat. Zudem sagen wir Quarto das wir mit Python3 arbeiten. Für unseren Ausgabeformat, welches HTML sein soll, definieren wir folgende global Optionen:\n\n- `embed-resources: true`:  Generiert ein einzelnes HTML File.\n- `code-fold: true`: Alle Code Cells werden eingeklappt.\n\n```{.default}\n---\ntitle: Visualisierung Zeckenstiche\nauthor: Vorname Nachname\njupyter: python3\nformat:\n    html:\n        embed-resources: true\n        code-fold: true\n---\n```\n\nQuarto gibt uns zudem die Möglichkeit unser File als Vorschau darzustellen. Öffne hierfür eine neue Konsole, indem du auf das grosse `+` in Jupyter Lab klickst. Wähle unter Other das Terminal aus. Mit dem Command `quarto preview visualisierung_zeckenstiche.ipynb` erhaltet ihr ein Preview im Internet Explorer.\n\n#### Cell Options\n\nCell Options können dazu benutzt werden, um das Verhalten einer Cell zu verändern. Dabei werden diese Optionen mittels des Vorschubs `#|` am Anfang der Cell eingefügt. Wenn ihr eine Option für alle Cells haben wollt, könnt ihr diese als globale Optionen in den Metadaten von Quarto setzen (analog zu `code-fold: true`).\n\n```{.default}\n#| echo: false\n#| code-summary: This is a Title for a collapsed Code Block\n\nPython Code...\n```\n\nDie häufigsten Options sind:\n\n- `eval`: Soll die Code Cell ausgeführt werden.\n- `echo`: Soll der Code der Cell angezeigt werden.\n- `output`: Soll der Code Output dargestellt werden.\n- `code-fold`: Soll die Code Cell eingeklappt werden.\n- `code-summary`: Wenn `code-fold` auf `true` gesetzt ist kann ein Titel für die Code Cell gesetzt werden.\n\nEs gibt aber noch viele weitere Möglichkeiten (siehe [hier](https://quarto.org/docs/reference/cells/cells-jupyter.html)). \n\n#### Page Layout\n\nMit Quarto könnt ihr euer Webseiten Layout relativ einfach anpassen. Ihr könnt zum Beispiel mit folgendem Code ein Grid erstellen, welcher aus zwei Spalten besteht. Eine Spalte ist 9 und die Zweite 3 breit. Die Gesamtbreite ist immer 12.\n\n```{.default}\n::: {.grid}\n\n::: {.g-col-9}\nText 1\n:::\n\n::: {.g-col-3}\nText 2\n:::\n\n:::\n```\n\nWeitere Möglichkeiten findet ihr [hier](https://quarto.org/docs/output-formats/page-layout.html).\n\n#### Tabellen\n\nEine Tabelle muss nach folgender Markdown Syntax erstellt werden (siehe [Quarto Tables](https://quarto.org/docs/authoring/tables.html)):\n\n```{.default}\n|Name |Gender|Age  |Origin | \n|-----|:-----|:---:|:-----:|\n|Jack |Male  |23   |USA    |\n|Susan|Female|22   |Canada |\n\n: Name der Tabelle {#tbl-names}\n```\n\n- Die erste Zeile ist die Tabellenüberschrift\n- Die zweite Zeile beinhaltet Bindestriche \"-\" und optionalen Doppelpunkten \":\", um den Text in den Spalten auszurichten.\n    - `:---` für die linke Ausrichtung\n    - `:---:` für die mittlere Ausrichtung\n    - `---:` für die rechte Ausrichtung\n- Die weiteren Zeilen beinhalten der Tabelleninhalt. \n- Mit dem : unter der Tabelle kannst du den Namen der Tabelle definieren. Mit `{#tbl-???}` kannst du den Namen für einen Querverweise im Text erstellen. Dieser kann dann mittels `@tbl-???` im Text aufrufen.\n\nEine praktische Hilfe für das Erstellen einer Tabelle ist der [Tablesgenerator](https://www.tablesgenerator.com/).\n\n#### Bilder\n\nEin Bild kann ebenfalls via Markdown Syntax hinzugefügt werden. Zuerst folgt die Caption des Bildes, gefolgt vom Bild selbst. Mit `{#fig-???}` kannst du einen Querverweis für das Bild erstellen. Gleich wie bei der Tabelle kannst du ihn im Text mittels `@fig-???` aufrufen.\n\n```{.default}\n![Caption](../images/test.png){#fig-???}\n```\n\nWeitere Information findet ihr auf [Quarto](https://quarto.org/docs/authoring/figures.html).\n\n### Aufgabe \n\nSeht euch die [Webseite](https://modul-agi.github.io/WebGIS2_Zeckenstiche/) an. Versucht nun die Struktur dieser Webseite so gut wie möglich in eurem Jupyter Notebook nachzubauen. Nutzt dafür die oben beschriebenen Methoden. Das Bild findet ihr in den Übungsdaten.\n\nBenutze zudem die Cell Options um euren Code sauber darzustellen. Nutzt dazu `echo` und `output` um unnötige Cell Codes und Outputs nicht auszugeben. Benenne zudem alle eingeklappten Code Cells sinnvoll mittels `code-summary`. \n\n## Übung 7: Notebook in HTML konvertieren\n\nDamit wir nun unser Jupyter Notebook publizieren können, müssen wir davon einen HTML Output generieren.\n\nDazu nützen wir wieder Quarto in der Konsole. Aber anstelle des `preview` Commands nutzen wir den `render` Command, sprich `quarto render visualisierung_zeckenstiche.ipynb`. Da wir in den Quarto Metadaten als format HTML angegeben haben, wird Quarto ein HTML File generieren.\n\nÄndere zum Schluss den Namen des HTML Files auf `index.html`, damit später GitHub Pages das File automatisch als Startseite erkennt. Mit Rechtsklick auf das File kann über `Download` das HTML File heruntergeladen werden.\n\n## Übung 8: GitHub und Publizieren\n\n:::{.callout-note}\nGitHub ist eine webbasierte Plattform, die Hosting für Git-Repositories bereitstellt. Es bietet Tools für die Zusammenarbeit, Codeüberprüfung und Projektverwaltung. GitHub wird von Entwicklern weit verbreitet genutzt, um Open-Source-Projekte zu teilen, dazu beizutragen und zusammenzuarbeiten. Es bietet auch Funktionen wie die Verfolgung von Problemen (Issues) und Pull-Anfragen (Pull Requests).\n:::\n\n1. Registriert euch mit eurer privaten Email Adresse auf [GitHub](https://github.com/).\n\n2. Nun da ihr eingeloggt seid, könnt ihr euer Repository erstellen. Drücke hierfür oben rechts auf euren Avatar und wähle dann \"Your repositories\". Klicke anschliessend auf das grüne Symbol \"New\". Im neuen Fenster kannst du nun einen Namen für dein Repository definieren. Zudem kannst du die Sichtbarkeit des Repository anpassen, aber wir belassen es bei Public, damit wir dann auch das HTML File publizieren können. Schliesse das Ganze mit \"Create repository\" ab.\n\n    ![Repository erstellen Schritt 1](figures/github_1.PNG)\n\n    ![Repository erstellen Schritt 2](figures/github_2.PNG)\n\n3. Nun hast du ein leeres Repository. Es gibt verschiedene Möglichkeiten nun Daten in dieses Repository zu kriegen. Am einfachsten ist aber das direkte Hochladen von Files. Klicke hierfür auf \"uploading an existing file\" und ziehe anschliessend das Jupyter Notebook und dein daraus generiertes HTML File (`index.html`) in den Explorer. Gib eine kurze Commit Beschreibung und klicke auf \"Commit changes\". \n\n    ![](figures/github_3.PNG)\n\n    ![](figures/github_4.PNG)\n\n:::{.callout-note}\n# Update existierende Files\n\nWenn ihr nochmals Änderungen an den Files vornehmt, könnte ihr diese auf der Repository Seite über `Add File` vornehmen. Achte darauf das die Files den gleichen Namen haben, damit wird sichergestellt, dass das auf GitHub existierende File überschrieben wird.\n\n![](figures/github_11.PNG)\n:::\n\n4. Ihr seht nun eure Files im Repository. Geht nun auf Einstellungen um eure Webseite zu Publizieren. \n\n    ![](figures/github_5.PNG)\n\n    Geht auf Pages und setzt bei Branch die Einstellungen auf `main` und `/root` und klickt auf Save. Dies bewirkt, dass GitHub nun nach einem index.html in deinem main Branch sucht und aus diesem eine Webseite macht. \n\n    ![](figures/github_6.PNG)\n\n    Diesen Vorgang könnt ihr unter Actions finden. Sobald der orange Punkt zu einem grünen Häkchen wird, ist die Webseite fertig erstellt. \n\n    ![](figures/github_7.PNG)\n\n    Kehr nun zurück zu Pages in den Settings. Ihr sollten nun eine URL sehen, auf welcher eure Webseite läuft.\n\n    ![](figures/github_8.PNG) \n\n5. Zum Abschluss könnt ihr diese URL im About des Repositorys hinzufügen. Dies macht es euch einfacher auf die Webseite zuzugreifen, da ihr nicht immer den Link in den Settings suchen müsst, sondern direkt in eurem Repository angezeigt wird. \n\n    ![](figures/github_9.PNG)\n\n    Kopiere hierfür die URL und gehe auf den Code Tab und wählt dort das Rädchen neben dem About. Im Feld Webseite könnt ihr nun die URL reinkopieren. Speichert das mit \"Save Changes\". Nun sieht ihr unter dem About eure Webseite.\n\n    ![](figures/github_10.PNG)\n\n",
    "supporting": [
      "2_Uebung_Zeckenstiche_files"
    ],
    "filters": []
  }
}